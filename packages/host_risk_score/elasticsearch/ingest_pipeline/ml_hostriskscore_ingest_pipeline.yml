---
processors:
  - set:
    field: ingest_timestamp
    value: {{_ingest.timestamp}}
  - fingerprint:
    fields:
    # TODO: we might need Name and type
      @timestamp
      _id
    method: SHA-256
    target-field: _id
  - script: |
      double risk_score = (def)ctx.getByPath(params.risk_score);
      if (risk_score < 20) {
        ctx['risk'] = 'Unknown'
      }
      else if (risk_score >= 20 && risk_score < 40) {
        ctx['risk'] = 'Low'
      }
      else if (risk_score >= 40 && risk_score < 70) {
        ctx['risk'] = 'Moderate'
      }
      else if (risk_score >= 70 && risk_score < 90) {
        ctx['risk'] = 'High'
      }
      else if (risk_score >= 90) {
        ctx['risk'] = 'Critical'
      }
    params:
      risk_score: risk_stats.risk_score
