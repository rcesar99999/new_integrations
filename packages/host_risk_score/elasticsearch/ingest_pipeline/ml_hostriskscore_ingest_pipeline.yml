---
processors:
  - set:
      field: event.ingested
      copy_from: _ingest.timestamp
  - fingerprint:
      fields:
        - '@timestamp'
        - _id
      method: SHA-256
      target_field: _id
  - script:
      lang: painless
      source: |-
        double risk_score = (def)ctx.getByPath(params.risk_score);
        if (risk_score < 20) {
          ctx['host']['risk']['calculated_level'] = 'Unknown'
        }
        else if (risk_score >= 20 && risk_score < 40) {
          ctx['host']['risk']['calculated_level'] = 'Low'
        }
        else if (risk_score >= 40 && risk_score < 70) {
          ctx['host']['risk']['calculated_level'] = 'Moderate'
        }
        else if (risk_score >= 70 && risk_score < 90) {
          ctx['host']['risk']['calculated_level'] = 'High'
        }
        else if (risk_score >= 90) {
          ctx['host']['risk']['calculated_level'] = 'Critical'
        }
      params:
        risk_score: risk_stats.risk_score
